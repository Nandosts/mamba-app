<AppBarModifier title="ListCharacters" />

<p>
  Lorem ipsum, dolor sit amet consectetur adipisicing elit. Sapiente aut
  pariatur porro incidunt, vero quos magni, iste esse ea accusamus vel quis
  repellat iusto laborum voluptates error quo alias ab?
  <br />
  <br />
  <a href="/">Voltar</a>
</p>

<script>
  import Http from '@mamba/pos/api/http.js';
  import Storage from '@mamba/pos/api/storage.js';

  let fullList = Storage.getItem('starWarsCharacters') || [];

  function requestFromApi(url = 'https://swapi.dev/api/people/') {
    const myRequest = {
      url,
      method: 'GET',
      data: { title: 'Test', body: 'This is a Test.' },
      proxy: true,
    };

    Http.send(myRequest)
      .then(result => {
        // in case the request have no errors
        const char = JSON.parse(result.body);
        fullList = fullList.concat(char.results);

        if (char.next) {
          requestFromApi(char.next);
        } else {
          Storage.setItem('starWarsCharacters', fullList);
        }
      })
      .catch(error => {
        // if the request fails
        console.error(error.status);
        console.error(error.msg);
      });
  }

  if (fullList.length === 0) {
    requestFromApi();
  }

  export default {
    components: {
      AppBarModifier: '@mamba/appbar/Modifier.html',
    },
    data() {
      return {};
    },
    methods: {},
  };
</script>

<style type="text/postcss">
  p {
    padding: 20px;
    font-size: 22px;
  }
</style>
